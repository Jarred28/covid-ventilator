{% extends 'base.html' %}
{% load rest_framework %}
{% load static %}

{% block head %}
<title>Request Credentials</title>
{% endblock %}

{% block content %}
<div class="container">
  <h1 class="my-4 text-center">Request Credentials</h1>

  <form action="{% url 'request-credentials' %}" method="POST" novalidate>
    {% csrf_token %}
    <div class="card mb-4">
      <div class="card-body">
        <div>
          <div class="form-group">
            <label for="username">Username</label>
            <input name="username" class="form-control" type="text" id="username" required />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input name="email" class="form-control" type="text" id="email" required />
          </div>
        </div>

        <div id="entities">
          <h3>Entity Associations</h3>
          <select class="form-control entity-selector">
            <option value>-- Select entity --</option>
            <optgroup label="Hospital Group">
              {% for hospitalGroup in hospitalGroups %}
              <option value="Hospital Group_{{ hospitalGroup.id }}_{{ hospitalGroup.name }}">{{ hospitalGroup.name }}</option>
              {% endfor %}
              {% if hospitalGroups|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="Hospital">
              {% for hospital in hospitals %}
              <option value="Hospital_{{ hospital.id }}_{{ hospital.name }}">{{ hospital.name }}</option>
              {% endfor %}
              {% if hospitals|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="Supplier">
              {% for supplier in suppliers %}
              <option value="Supplier_{{ supplier.id }}_{{ supplier.name }}">{{ supplier.name }}</option>
              {% endfor %}
              {% if suppliers|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="System">
              {% for system in systems %}
              <option value="System_{{ system.id }}_{{ system.name }}">{{ system.name }}</option>
              {% endfor %}
              {% if systems|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
          </select>

          <div id="selected-entity" class="card mt-3 d-none">
            <h5 class="card-header title"></h5>
            <div class="card-body">
              <div class="form-group">
                <label for="hospitalName">Name</label>
                <input id="hospitalName" class="form-control" required />
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-dark btn-sm float-right btn-add-association" type="button">
                <i class="fa fa-plus"></i>
                Add Association
              </button>
            </div>
          </div>

          <table id="tblEntity" class="table table-bordered table-striped mt-3">
            <thead class="thead-dark">
              <tr>
                <th>Entity Type</th>
                <th>Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr class="d-none entity-row-template">
                <td class="type"></td>
                <td class="name"></td>
                <td class="actions">
                  <button class="btn btn-dark btn-sm btn-cancel" type="button">
                    <i class="fa fa-times mr-1"></i>
                    Cancel
                  </button>
                </td>
              </tr>
              <tr class="no-entity">
                <td colspan="3">
                  <div class="alert alert-info mb-0 text-center">
                    No entity being associated
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between mb-4">
      <button class="btn btn-lg btn-dark" type="button">
        <a class="text-decoration-none text-white" href="/">
          <i class="fa fa-angle-double-left mr-1"></i>
          Back to Log In
        </a>
      </button>
      <button type="submit" class="btn btn-dark btn-lg">Request Credentials</button>
    </div>
  </form>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'js/auth/request-credentials.js' %}"></script>
{% endblock %}
