{% extends 'base.html' %}
{% load rest_framework %}
{% load static %}

{% block head %}
<title>Request Credentials</title>
{% endblock %}

{% block content %}
<div class="container">
  <h1 class="my-4 text-center">Request Credentials</h1>

  {% for error in errors %}
  <div class="alert alert-danger text-center">
    {{ error }}
  </div>
  {% endfor %}

  <form action="{% url 'request-credentials' %}" method="POST" novalidate>
    {% csrf_token %}
    <div class="card mb-4">
      <div class="card-body">
        <div>
          <div class="form-group">
            <label for="username">Username</label>
            <input name="username" class="form-control" type="text" id="username" required />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input name="email" class="form-control" type="text" id="email" required />
          </div>
        </div>

        <div id="entities">
          <h3>Entity Associations</h3>
          <select class="form-control entity-selector">
            <option value>-- Select entity --</option>
            <optgroup label="Hospital Group">
              {% for hospitalGroup in hospitalGroups %}
              <option value="Hospital Group_{{ hospitalGroup.id }}_{{ hospitalGroup.name }}">{{ hospitalGroup.name }}</option>
              {% endfor %}
              {% if hospitalGroups|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="Hospital">
              {% for hospital in hospitals %}
              <option value="Hospital_{{ hospital.id }}_{{ hospital.name }}">{{ hospital.name }}</option>
              {% endfor %}
              {% if hospitals|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="Supplier">
              {% for supplier in suppliers %}
              <option value="Supplier_{{ supplier.id }}_{{ supplier.name }}">{{ supplier.name }}</option>
              {% endfor %}
              {% if suppliers|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
            <optgroup label="System">
              {% for system in systems %}
              <option value="System_{{ system.id }}_{{ system.name }}">{{ system.name }}</option>
              {% endfor %}
              {% if systems|length == 0 %}
              <option value disabled>-- None --</option>
              {% endif %}
            </optgroup>
          </select>

          <div id="selected-entity" class="card mt-3 d-none">
            <h5 class="card-header title"></h5>
            <div class="card-body">
              <div class="form-group">
                <label for="hospitalName">Name</label>
                <input id="hospitalName" class="form-control" required />
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-dark btn-sm float-right btn-add-association" type="button">
                <i class="fa fa-plus"></i>
                Add Association
              </button>
            </div>
          </div>

          <table id="tblEntity" class="table table-bordered table-striped mt-3">
            <thead class="thead-dark">
              <tr>
                <th>Entity Type</th>
                <th>Name</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr class="d-none entity-row-template">
                <td class="type"></td>
                <td class="name"></td>
                <td class="actions">
                  <button class="btn btn-dark btn-sm btn-cancel" type="button">
                    <i class="fa fa-times mr-1"></i>
                    Cancel
                  </button>
                </td>
              </tr>
              <tr class="no-entity">
                <td colspan="3">
                  <div class="alert alert-info mb-0 text-center">
                    No entity being associated
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
<!--     <button type="button" value="Add" onclick="javascript:add_supplier();"> Add Supplier</button>
    <button type="button" value="Add" onclick="javascript:add_group();"> Add Hospital Group</button>
    <button type="button" value="Add" onclick="javascript:add_supplier();"> Add Supplier</button> -->

<!--     {% if serializer.errors and serializer.errors.non_field_errors %}
      {% for error in serializer.errors.non_field_errors %}
        <div class="alert alert-danger">
          <p class="mb-0">{{ error }}</p>
        </div>
      {% endfor %}
    {% endif %}
    {% regroup serializer|dictsort:"section" by section as sections %}
    {% for section in sections %}
      <div class="card mb-4">
        {% if section.grouper %}
        <h3 class="card-header">{{ section.grouper }}</h3>
        {% endif %}
        <div class="card-body">
          {% for field in section.list %}
            {% render_field field style=style %}
             {% if field.errors %}
              {% for error in field.errors %}
                <div class="alert alert-danger">
                  <p class="mb-0">ERROR: {{ error }}</p>
                </div>
              {% endfor %}
            {% endif %} 
          {% endfor %}
        </div>
      </div>
      {% if not section.grouper %}
      <div class="alert alert-info mb-4">
        <p class="mb-0">Please only fill out the section corresponding to the user type you selected above:</p>
      </div>
      {% endif %}
    {% endfor %} -->

    <div class="d-flex justify-content-between mb-4">
      <button class="btn btn-lg btn-dark">
        <a class="text-decoration-none text-white" href="/">
          <i class="fa fa-angle-double-left mr-1"></i>
          Back to Log In
        </a>
      </button>
      <button type="submit" class="btn btn-dark btn-lg">Request Credentials</button>
    </div>
  </form>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'js/auth/request-credentials.js' %}"></script>
{% endblock %}
