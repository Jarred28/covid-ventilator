{% extends 'base.html' %}
{% load rest_framework %}

{% block head %}
<title>Requests - Hospital Administrator</title>
{% endblock %}

{% block content %}
<div class="card fixed fill">
  <h1 class="card-header bg-white">Requests</h1>
  <div class="card-body">
    <table class="table table-bordered table-striped mb-4">
      <thead class="thead-dark">
        <tr>
          <th>Request Status</th>
          <th>Request Quantity</th>
          <th>Allocated Quantity</th>
          <th>Shipped Quantity</th>
          <th>Allocations or Approve Request</th>
        </tr>
      </thead>
      <tbody>
        {% for request in requests %}
        <tr>
          <td>
          {% if request.status == 'Open' %}
            <span class="badge badge-primary">Open</span>
          {% elif request.status == 'Approved' %}
            <span class="badge badge-success">Approved</span>
          {% elif request.status == 'Cancelled' %}
            <span class="badge badge-info">Replaced</span>
          {% elif request.status == 'Closed' %}
            <span class="badge badge-danger">Cancelled</span>
          {% endif %}
          </td>
          <td>{{ request.requested_qty }}</td>
          <td>{{ request.allocated_qty }}</td>
          <td>{{ request.shipped_qty }}</td>
        {% if request.status == 'Open' %}
          <td>
            <form action="{% url 'request-approval' %}" method="POST">
              {% csrf_token %}
              <input type="hidden" name="request_id" value="{{ request.id }}">
              <button type="submit" class="btn btn-dark btn-sm">Approve</button>
            </form>
          </td>
        {% elif request.status == 'Approved' %}
          <td>
            <a class="btn btn-dark btn-sm" href="{% url 'request-allocation-list' request.id %}">Allocations</a>
          </td>
        </tr>
        {% endif %}
        {% endfor %}
        {% if requests|length == 0 %}
        <tr>
          <td colspan="5">
            <div class="alert alert-info mb-0 text-center">
              No requested order to display
            </div>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="card-footer text-right bg-white">
    <button class="btn btn-dark mb-0" data-toggle="modal" data-target="#ventilatorRequestModal">Submit a Ventilator Request</button>
  </div>
</div>

<div class="modal fade" id="ventilatorRequestModal" tabindex="-1" role="dialog" aria-labelledby="ventilatorRequestModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Submit a Ventilator Request</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% csrf_token %}
        <label for="num_requested"> How many ventilators do you need? </label>
        <input type="text" id="num_requested" class="form-control" name="num_requested">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-dark">Save</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
